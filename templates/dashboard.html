{% extends "base.html" %}

{% block title %}Dashboard - NousCard{% endblock %}

{% block content %}
<!-- âœ… REMOVIDO: SeÃ§Ã£o de boas-vindas e status do usuÃ¡rio (jÃ¡ estÃ¡ na base.html) -->

<!-- ===================== KPIs ===================== -->
<section class="nc-section">
    <h2 class="nc-subtitle">VisÃ£o Geral</h2>

    <div class="nc-kpis">
        <button type="button" class="nc-kpi-card kpi-click" data-acao="vendas" aria-label="Ver detalhamento de vendas">
            <div class="kpi-icon kpi-blue" aria-hidden="true">ğŸ›ï¸</div>
            <div class="kpi-info">
                <div class="kpi-label">Total Vendas</div>
                <div class="kpi-value kpi-value-vendas" data-loading="true">
                    <span class="loading-spinner" aria-label="Carregando">â³</span>
                </div>
            </div>
        </button>

        <button type="button" class="nc-kpi-card kpi-click" data-acao="recebidos" aria-label="Ver detalhamento de recebimentos">
            <div class="kpi-icon kpi-green" aria-hidden="true">ğŸ’¸</div>
            <div class="kpi-info">
                <div class="kpi-label">Total Recebido</div>
                <div class="kpi-value kpi-value-recebido" data-loading="true">
                    <span class="loading-spinner" aria-label="Carregando">â³</span>
                </div>
            </div>
        </button>

        <button type="button" class="nc-kpi-card kpi-click" data-acao="diferencas" aria-label="Ver detalhamento de diferenÃ§as">
            <div class="kpi-icon kpi-yellow" aria-hidden="true">âš ï¸</div>
            <div class="kpi-info">
                <div class="kpi-label">DiferenÃ§a</div>
                <div class="kpi-value kpi-value-diferenca" data-loading="true">
                    <span class="loading-spinner" aria-label="Carregando">â³</span>
                </div>
            </div>
        </button>

        <div class="nc-kpi-card">
            <div class="kpi-icon kpi-red" aria-hidden="true">ğŸ””</div>
            <div class="kpi-info">
                <div class="kpi-label">Alertas</div>
                <div class="kpi-value kpi-value-alertas">0</div>
            </div>
        </div>
    </div>
    
    <div id="dashboard-error" class="nc-error" role="alert" style="display:none;"></div>
</section>

<!-- ===================== ADQUIRENTES ===================== -->
<section class="nc-section">
    <div class="nc-header-row">
        <h2 class="nc-subtitle">Totais por Adquirente</h2>
        <small class="nc-muted">Clique na adquirente ou no KPI para ver o detalhamento.</small>
    </div>
    <div id="acqContainer" class="nc-acq-grid"></div>
</section>

<!-- ===================== GRÃFICO VENDAS X RECEBIDO ===================== -->
<section class="nc-section">
    <h2 class="nc-subtitle">GrÃ¡fico de Vendas x Recebido</h2>
    <div class="nc-graphs-container">
        <canvas id="graficoVendasRecebidos" role="img" aria-label="GrÃ¡fico de barras comparando vendas e recebimentos"></canvas>
    </div>
</section>

<!-- ===================== GRÃFICO BANDEIRAS ===================== -->
<section class="nc-section">
    <h2 class="nc-subtitle">Vendas por Bandeira</h2>
    <div class="nc-graphs-container">
        <canvas id="graficoBandeiras" role="img" aria-label="GrÃ¡fico de rosca mostrando distribuiÃ§Ã£o de vendas por bandeira"></canvas>
    </div>
</section>

<!-- Scripts -->
<!-- âœ… CORREÃ‡ÃƒO: Remover espaÃ§os extras na URL do Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>

<!-- MODAL DE DETALHAMENTO -->
<div id="modalDetalhe" class="nc-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="modalTitulo">
    <div class="nc-modal-backdrop"></div>
    <div class="nc-modal-content">
        <div class="nc-modal-header">
            <h3 id="modalTitulo"></h3>
            <button type="button" class="nc-modal-close" aria-label="Fechar modal">âœ•</button>
        </div>
        <div class="nc-modal-body">
            <!-- âœ… CORREÃ‡ÃƒO: Container com scroll horizontal apenas se necessÃ¡rio -->
            <div class="table-container">
                <table id="modalTabela" class="nc-table" role="table" aria-label="Tabela de detalhamento">
                </table>
            </div>
            <div id="modal-empty" class="nc-empty-state" style="display:none;" role="status">Nenhum dado para exibir.</div>
        </div>
        <div class="nc-modal-footer">
            <button type="button" class="nc-btn-secondary" onclick="fecharModal()">Fechar</button>
        </div>
    </div>
</div>
{% endblock %}
