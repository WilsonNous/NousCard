{% extends "base.html" %}

{% block title %}Dashboard - NousCard{% endblock %}

{% block content %}
<section class="nc-section">
    <h2 class="nc-title">Ol√°, {{ usuario.nome | e }} üëã</h2>

    <div class="nc-user-status">
        <div>
            <span class="label">Acesso:</span>
            {% if is_master %}
                <span class="role master">MASTER</span>
            {% elif is_admin %}
                <span class="role admin">ADMINISTRADOR</span>
            {% else %}
                <span class="role user">Usu√°rio</span>
            {% endif %}
        </div>
        <div>
            <span class="label">Empresa:</span>
            {% if is_master %}
                <span>(MASTER)</span>
            {% else %}
                {{ usuario.empresa_nome | e if usuario.empresa_nome else "‚Äî" }}
            {% endif %}
        </div>
    </div>

    <div class="nc-dashboard-actions">
        <a href="{{ url_for('operacoes.importar_page') }}" class="nc-btn-primary">‚¨ÜÔ∏è Importar Arquivos</a>
        <a href="{{ url_for('operacoes.conciliar_page') }}" class="nc-btn-secondary">‚úîÔ∏è Concilia√ß√£o</a>
    </div>
</section>

<section class="nc-section">
    <h2 class="nc-subtitle">Vis√£o Geral</h2>

    <div class="nc-kpis">
        <button type="button" class="nc-kpi-card kpi-click" data-acao="vendas" aria-label="Ver detalhamento de vendas">
            <div class="kpi-icon kpi-blue" aria-hidden="true">üõçÔ∏è</div>
            <div class="kpi-info">
                <div class="kpi-label">Total Vendas</div>
                <div class="kpi-value kpi-value-vendas" data-loading="true">
                    <span class="loading-spinner" aria-label="Carregando">‚è≥</span>
                </div>
            </div>
        </button>

        <button type="button" class="nc-kpi-card kpi-click" data-acao="recebidos" aria-label="Ver detalhamento de recebimentos">
            <div class="kpi-icon kpi-green" aria-hidden="true">üí∏</div>
            <div class="kpi-info">
                <div class="kpi-label">Total Recebido</div>
                <div class="kpi-value kpi-value-recebido" data-loading="true">
                    <span class="loading-spinner" aria-label="Carregando">‚è≥</span>
                </div>
            </div>
        </button>

        <button type="button" class="nc-kpi-card kpi-click" data-acao="diferencas" aria-label="Ver detalhamento de diferen√ßas">
            <div class="kpi-icon kpi-yellow" aria-hidden="true">‚ö†Ô∏è</div>
            <div class="kpi-info">
                <div class="kpi-label">Diferen√ßa</div>
                <div class="kpi-value kpi-value-diferenca" data-loading="true">
                    <span class="loading-spinner" aria-label="Carregando">‚è≥</span>
                </div>
            </div>
        </button>

        <div class="nc-kpi-card">
            <div class="kpi-icon kpi-red" aria-hidden="true">üîî</div>
            <div class="kpi-info">
                <div class="kpi-label">Alertas</div>
                <div class="kpi-value kpi-value-alertas">0</div>
            </div>
        </div>
    </div>
    
    <div id="dashboard-error" class="nc-error" role="alert" style="display:none;"></div>
</section>

<section class="nc-section">
    <div class="nc-header-row">
        <h2 class="nc-subtitle">Totais por Adquirente</h2>
        <small class="nc-muted">Clique na adquirente ou no KPI para ver o detalhamento.</small>
    </div>
    <div id="acqContainer" class="nc-acq-grid"></div>
</section>

<section class="nc-section">
    <h2 class="nc-subtitle">Gr√°fico de Vendas x Recebido</h2>
    <div class="nc-graphs-container">
        <canvas id="graficoVendasRecebidos"></canvas>
    </div>
</section>

<section class="nc-section">
    <h2 class="nc-subtitle">Vendas por Bandeira</h2>
    <div class="nc-graphs-container">
        <canvas id="graficoBandeiras"></canvas>
    </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>

<!-- MODAL DE DETALHAMENTO -->
<div id="modalDetalhe" class="nc-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="modalTitulo">
    <div class="nc-modal-backdrop"></div>
    <div class="nc-modal-content">
        <div class="nc-modal-header">
            <h3 id="modalTitulo"></h3>
            <button type="button" class="nc-modal-close" aria-label="Fechar modal">‚úï</button>
        </div>
        <div class="nc-modal-body">
            <div class="table-container">
                <table id="modalTabela" class="nc-table">
                </table>
            </div>
            <div id="modal-empty" class="nc-empty-state" style="display:none;">Nenhum dado para exibir.</div>
        </div>
        <div class="nc-modal-footer">
            <button type="button" class="nc-btn-secondary" onclick="fecharModal()">Fechar</button>
        </div>
    </div>
</div>
{% endblock %}
