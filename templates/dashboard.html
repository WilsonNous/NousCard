{% extends "base.html" %}

{% block content %}

<!-- ============================================================
     SEÃ‡ÃƒO: BOAS-VINDAS + INFORMAÃ‡Ã•ES DO USUÃRIO
============================================================ -->
<section class="nc-section">
    <h2 class="nc-title">OlÃ¡, {{ usuario.nome }} ğŸ‘‹</h2>

    <div class="nc-user-status">
        <div>
            <span class="label">Acesso:</span>
            {% if session.get('is_master') %}
                <span class="role master">MASTER</span>
            {% elif session.get('is_admin') %}
                <span class="role admin">ADMINISTRADOR</span>
            {% else %}
                <span class="role user">UsuÃ¡rio</span>
            {% endif %}
        </div>

        <div>
            <span class="label">Empresa:</span>
            {% if session.get('is_master') %}
                â€” (usuÃ¡rio MASTER sem vÃ­nculo)
            {% else %}
                {{ usuario.empresa_nome }}
            {% endif %}
        </div>
    </div>

    <div class="nc-dashboard-actions">
        <a href="{{ url_for('operacoes.importar_page') }}" class="nc-btn-primary">â¬†ï¸ Importar Arquivos</a>
        <a href="{{ url_for('operacoes.conciliar_page') }}" class="nc-btn-secondary">âœ”ï¸ ConciliaÃ§Ã£o</a>
    </div>
</section>



<!-- ============================================================
     SEÃ‡ÃƒO: KPIs
============================================================ -->
<section class="nc-section">
    <h2 class="nc-subtitle">VisÃ£o Geral</h2>

    <div class="nc-kpis">

        <div class="nc-kpi-card">
            <div class="kpi-icon kpi-blue">ğŸ›ï¸</div>
            <div class="kpi-info">
                <div class="kpi-label">Total de Vendas</div>
                <div class="kpi-value">R$ {{ "%.2f"|format(kpis.total_vendas) }}</div>
            </div>
        </div>

        <div class="nc-kpi-card">
            <div class="kpi-icon kpi-green">ğŸ’¸</div>
            <div class="kpi-info">
                <div class="kpi-label">Total Recebido</div>
                <div class="kpi-value">R$ {{ "%.2f"|format(kpis.total_recebido) }}</div>
            </div>
        </div>

        <div class="nc-kpi-card">
            <div class="kpi-icon kpi-yellow">âš ï¸</div>
            <div class="kpi-info">
                <div class="kpi-label">DiferenÃ§a</div>
                <div class="kpi-value">{{ "%.2f"|format(kpis.diferenca) }}</div>
            </div>
        </div>

        <div class="nc-kpi-card">
            <div class="kpi-icon kpi-red">ğŸ””</div>
            <div class="kpi-info">
                <div class="kpi-label">Alertas</div>
                <div class="kpi-value">{{ kpis.alertas }}</div>
            </div>
        </div>

    </div>
</section>



<!-- ============================================================
     SEÃ‡ÃƒO: GRÃFICO PRINCIPAL
============================================================ -->
<section class="nc-section">
    <h2 class="nc-subtitle">GrÃ¡fico de Vendas x Recebido</h2>

    <div class="nc-graphs-container">
        <canvas id="graficoVendasRecebidos"></canvas>
    </div>
</section>

<!-- Importa Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const ctx = document.getElementById("graficoVendasRecebidos");
    if (!ctx) return;

    const vendas = {{ kpis.total_vendas|float }};
    const recebidos = {{ kpis.total_recebido|float }};

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: ["Vendas", "Recebido"],
            datasets: [{
                label: "Valores",
                data: [vendas, recebidos],
                backgroundColor: ["#1877f2", "#3cb371"]
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: (value) =>
                            "R$ " + value.toLocaleString("pt-BR", { minimumFractionDigits: 2 })
                    }
                }
            }
        }
    });

});
</script>



<!-- ============================================================
     SEÃ‡ÃƒO: PLACEHOLDER PARA PRÃ“XIMOS GRÃFICOS
============================================================ -->
<section class="nc-section">
    <h2 class="nc-subtitle">Mais AnÃ¡lises</h2>

    <div class="nc-graph-placeholder">
        <i>ğŸ“ˆ</i>
        <p>GrÃ¡ficos com bandeiras, adquirentes e tendÃªncias aparecerÃ£o aqui.</p>
    </div>
</section>

{% endblock %}
