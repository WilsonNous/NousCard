<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}NousCard{% endblock %}</title>
    
    <!-- SEO e Social -->
    <meta name="description" content="NousCard: ConciliaÃ§Ã£o simples de cartÃµes para micro e pequenas empresas">
    
    <!-- Favicon (com fallback para evitar 404) -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32x32.png') }}" onerror="this.style.display='none'">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    {% block extra_head %}{% endblock %}
</head>

<body class="nc-body">
    
    <!-- Skip Link para Acessibilidade -->
    <a href="#main-content" class="skip-link">Pular para o conteÃºdo</a>
    
    <!-- ===================== TOPBAR ===================== -->
    <header class="nc-topbar" role="banner">
        <div class="nc-topbar-left">
            <a href="{{ url_for('dashboard.dashboard') }}" class="nc-logo" aria-label="NousCard - PÃ¡gina inicial">
                NousCard
            </a>
        </div>
        
        <nav class="nc-topbar-nav" role="navigation" aria-label="NavegaÃ§Ã£o principal">
            <a href="{{ url_for('dashboard.dashboard') }}" 
               class="nc-topbar-item {% if request.endpoint == 'dashboard.dashboard' %}active{% endif %}"
               aria-label="Ir para Dashboard"
               {% if request.endpoint == 'dashboard.dashboard' %}aria-current="page"{% endif %}>
                ğŸ“Š Dashboard
            </a>
            <a href="{{ url_for('operacoes.importar_page') }}" 
               class="nc-topbar-item {% if request.endpoint == 'operacoes.importar_page' %}active{% endif %}"
               aria-label="Importar arquivos">
                â¬†ï¸ Importar
            </a>
            <a href="{{ url_for('operacoes.arquivos_importados_page') }}" 
               class="nc-topbar-item {% if request.endpoint == 'operacoes.arquivos_importados_page' %}active{% endif %}"
               aria-label="Ver arquivos importados">
                ğŸ“‚ Arquivos
            </a>
            <a href="{{ url_for('operacoes.conciliar_page') }}" 
               class="nc-topbar-item {% if request.endpoint == 'operacoes.conciliar_page' %}active{% endif %}"
               aria-label="Executar conciliaÃ§Ã£o">
                âœ”ï¸ ConciliaÃ§Ã£o
            </a>
            
            {% if is_master %}
                <a href="{{ url_for('empresas.listar_empresas') }}" 
                   class="nc-topbar-item {% if request.endpoint == 'empresas.listar_empresas' %}active{% endif %}"
                   aria-label="Gerenciar empresas (admin)">
                    ğŸ¢ Empresas
                </a>
            {% endif %}
            
            <a href="{{ url_for('auth.logout') }}" 
               class="nc-topbar-item logout"
               aria-label="Sair da conta">
                ğŸšª Sair
            </a>
        </nav>
    </header>
    
    <!-- ===================== CONTEÃšDO ===================== -->
    <main id="main-content" class="nc-content" role="main" tabindex="-1">
        
        <!-- âœ… Barra de Status do UsuÃ¡rio -->
        {% if usuario %}
        <div class="nc-user-status-bar">
            <div class="nc-user-info">
                <strong>ğŸ‘¤ {{ usuario.nome | e }}</strong>
                <span class="nc-user-badge {% if is_master %}nc-badge-master{% elif usuario.admin %}nc-badge-admin{% else %}nc-badge-user{% endif %}">
                    {% if is_master %}MASTER{% elif usuario.admin %}ADMIN{% else %}UsuÃ¡rio{% endif %}
                </span>
            </div>
            
            <div class="nc-user-company">
                <span class="nc-label">Empresa:</span>
                <strong class="nc-value">
                    {% if is_master %}
                        (Todas)
                    {% elif usuario.empresa and usuario.empresa.nome %}
                        {{ usuario.empresa.nome | e }}
                    {% elif empresa_nome %}
                        {{ empresa_nome | e }}
                    {% else %}
                        <span class="nc-warning">NÃ£o vinculada</span>
                    {% endif %}
                </strong>
            </div>
            
            {% if usuario.ultimo_login %}
            <div class="nc-user-last-login">
                Ãšltimo acesso: {{ usuario.ultimo_login.strftime('%d/%m/%Y %H:%M') }}
            </div>
            {% endif %}
        </div>
        {% endif %}
        <!-- âœ… FIM: Barra de Status do UsuÃ¡rio -->
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="nc-flash-messages" role="alert" aria-live="polite">
                    {% for category, message in messages %}
                        <div class="nc-flash nc-flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <!-- ConteÃºdo da PÃ¡gina -->
        {% block content %}{% endblock %}
    </main>
    
    <!-- ===================== RODAPÃ‰ ===================== -->
    <footer class="nc-footer" role="contentinfo">
        NousCard Â© {{ current_year }} â€” Desenvolvido por <strong>Nous Tecnologia</strong> â€¢
        <a href="mailto:contato@noustecnologia.com.br" aria-label="Enviar email para Nous Tecnologia">Fale Conosco</a>
    </footer>
    
    <!-- Scripts Globais -->
    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
    
    {% block extra_scripts %}{% endblock %}
    
</body>
</html>
