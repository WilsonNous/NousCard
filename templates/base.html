<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}NousCard{% endblock %}</title>
    
    <!-- SEO e Social -->
    <meta name="description" content="NousCard: ConciliaÃ§Ã£o simples de cartÃµes para micro e pequenas empresas">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32x32.png') }}">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    {% block extra_head %}{% endblock %}
</head>

<body class="nc-body">
    
    <!-- Skip Link para Acessibilidade -->
    <a href="#main-content" class="skip-link">Pular para o conteÃºdo</a>
    
    <!-- ===================== TOPBAR ===================== -->
    <header class="nc-topbar" role="banner">
        <div class="nc-topbar-left">
            <a href="{{ url_for('dashboard.dashboard') }}" class="nc-logo" aria-label="NousCard - PÃ¡gina inicial">
                NousCard
            </a>
        </div>
        
        <nav class="nc-topbar-nav" role="navigation" aria-label="NavegaÃ§Ã£o principal">
            <a href="{{ url_for('dashboard.dashboard') }}" 
               class="nc-topbar-item {% if request.endpoint == 'dashboard.dashboard' %}active{% endif %}"
               aria-label="Ir para Dashboard"
               {% if request.endpoint == 'dashboard.dashboard' %}aria-current="page"{% endif %}>
                ğŸ“Š Dashboard
            </a>
            <a href="{{ url_for('operacoes.importar_page') }}" 
               class="nc-topbar-item {% if request.endpoint == 'operacoes.importar_page' %}active{% endif %}"
               aria-label="Importar arquivos">
                â¬†ï¸ Importar
            </a>
            <a href="{{ url_for('operacoes.arquivos_importados_page') }}" 
               class="nc-topbar-item {% if request.endpoint == 'operacoes.arquivos_importados_page' %}active{% endif %}"
               aria-label="Ver arquivos importados">
                ğŸ“‚ Arquivos
            </a>
            <a href="{{ url_for('operacoes.conciliar_page') }}" 
               class="nc-topbar-item {% if request.endpoint == 'operacoes.conciliar_page' %}active{% endif %}"
               aria-label="Executar conciliaÃ§Ã£o">
                âœ”ï¸ ConciliaÃ§Ã£o
            </a>
            
            {% if is_master %}
                <a href="{{ url_for('empresas.listar_empresas') }}" 
                   class="nc-topbar-item {% if request.endpoint == 'empresas.listar_empresas' %}active{% endif %}"
                   aria-label="Gerenciar empresas (admin)">
                    ğŸ¢ Empresas
                </a>
            {% endif %}
            
            <a href="{{ url_for('auth.logout') }}" 
               class="nc-topbar-item logout"
               aria-label="Sair da conta">
                ğŸšª Sair
            </a>
        </nav>
    </header>
    
    <!-- ===================== CONTEÃšDO ===================== -->
    <main id="main-content" class="nc-content" role="main" tabindex="-1">
        
        <!-- âœ… NOVO: Barra de Status do UsuÃ¡rio (adicionar apÃ³s flash messages) -->
        {% if usuario %}
        <div class="nc-user-status-bar" style="background:var(--gray-light);padding:0.75rem 1rem;margin-bottom:1rem;border-radius:8px;display:flex;align-items:center;gap:1rem;flex-wrap:wrap;font-size:0.9rem;">
            <div>
                <strong>ğŸ‘¤ {{ usuario.nome | e }}</strong>
                <span style="color:var(--gray-dark);margin-left:0.5rem;">
                    {% if is_master %}
                        <span style="background:var(--primary);color:white;padding:2px 8px;border-radius:4px;font-size:0.8rem;">MASTER</span>
                    {% elif usuario.admin %}
                        <span style="background:var(--kpi-green);color:white;padding:2px 8px;border-radius:4px;font-size:0.8rem;">ADMIN</span>
                    {% else %}
                        <span style="background:var(--gray);color:var(--text);padding:2px 8px;border-radius:4px;font-size:0.8rem;">UsuÃ¡rio</span>
                    {% endif %}
                </span>
            </div>
            <div style="border-left:1px solid var(--gray);padding-left:1rem;">
                <span style="color:var(--gray-dark);">Empresa:</span>
                {% if is_master %}
                    <strong style="margin-left:0.25rem;">(Todas)</strong>
                {% elif usuario.empresa and usuario.empresa.nome %}
                    <strong style="margin-left:0.25rem;">{{ usuario.empresa.nome | e }}</strong>
                {% elif empresa_nome %}
                    <strong style="margin-left:0.25rem;">{{ empresa_nome | e }}</strong>
                {% else %}
                    <strong style="margin-left:0.25rem;color:var(--kpi-red);">NÃ£o vinculada</strong>
                {% endif %}
            </div>
            {% if usuario.ultimo_login %}
            <div style="margin-left:auto;color:var(--gray-dark);font-size:0.85rem;">
                Ãšltimo acesso: {{ usuario.ultimo_login.strftime('%d/%m/%Y %H:%M') }}
            </div>
            {% endif %}
        </div>
        {% endif %}
        <!-- âœ… FIM: Barra de Status do UsuÃ¡rio -->
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="nc-flash-messages" role="alert" aria-live="polite">
                    {% for category, message in messages %}
                        <div class="nc-flash nc-flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </main>
    
    <!-- ===================== RODAPÃ‰ ===================== -->
    <footer class="nc-footer" role="contentinfo">
        NousCard Â© {{ current_year }} â€” Desenvolvido por <strong>Nous Tecnologia</strong> â€¢
        <a href="mailto:contato@noustecnologia.com.br" aria-label="Enviar email para Nous Tecnologia">Fale Conosco</a>
    </footer>
    
    <!-- Scripts Globais -->
    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
    
    {% block extra_scripts %}{% endblock %}
    
</body>
</html>
