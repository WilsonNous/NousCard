{% extends "base.html" %}

{% block title %}Gerenciar Empresas - NousCard{% endblock %}

{% block content %}
<section class="nc-section">
    {% if not is_master %}
        <div class="nc-access-denied" role="alert">
            <span aria-hidden="true">üîí</span>
            <h2>Acesso Restrito</h2>
            <p>Esta p√°gina √© acess√≠vel apenas para usu√°rios MASTER.</p>
            <a href="{{ url_for('dashboard.dashboard') }}" class="nc-btn nc-btn-primary">Voltar ao dashboard</a>
        </div>
    {% else %}
        <div class="nc-section-header">
            <div>
                <h2>üè¢ Empresas</h2>
                {% if empresas and empresas.total %}
                <p class="nc-section-subtitle">{{ empresas.total }} empresa(s) cadastrada(s)</p>
                {% endif %}
            </div>
            <a href="{{ url_for('empresas.nova_empresa') }}" class="nc-btn nc-btn-primary">+ Nova empresa</a>
        </div>
        
        {% if empresas and empresas.items %}
            <table class="nc-table" role="table" aria-label="Lista de empresas cadastradas">
                <caption class="nc-sr-only">Tabela com {{ empresas.total }} empresas cadastradas.</caption>
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Nome</th>
                        <th scope="col">Documento</th>
                        <th scope="col">Status</th>
                        <th scope="col">Criada em</th>
                        <th scope="col" class="nc-sr-only">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for e in empresas.items %}
                        <tr class="{% if e.id == session.get('empresa_id') %}nc-row-current{% endif %}">
                            <td>{{ e.id }}</td>
                            <td><strong>{{ e.nome | e }}</strong></td>
                            <td>{{ e.documento | e if e.documento else "-" }}</td>
                            <td>
                                <span class="nc-status nc-status-{{ 'active' if e.ativo else 'inactive' }}">
                                    <span aria-hidden="true">{{ "‚úÖ" if e.ativo else "‚è∏Ô∏è" }}</span>
                                    {{ "Sim" if e.ativo else "N√£o" }}
                                </span>
                            </td>
                            <td>{{ e.criado_em.strftime("%d/%m/%Y") if e.criado_em else "-" }}</td>
                            <td class="nc-table-actions">
                                <a href="{{ url_for('empresas.editar_empresa', empresa_id=e.id) }}" 
                                   class="nc-btn nc-btn-sm nc-btn-outline"
                                   aria-label="Editar empresa {{ e.nome | e }}">
                                    <span aria-hidden="true">‚úèÔ∏è</span>
                                    <span class="nc-sr-only">Editar</span>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            {% if empresas.pages > 1 %}
            <nav class="nc-pagination" role="navigation" aria-label="Pagina√ß√£o de empresas">
                {% if empresas.has_prev %}
                <a href="?page={{ empresas.prev_num }}" class="nc-btn nc-btn-sm" aria-label="P√°gina anterior">‚Üê Anterior</a>
                {% endif %}
                
                <span class="nc-page-info" aria-current="page">P√°gina {{ empresas.page }} de {{ empresas.pages }}</span>
                
                {% if empresas.has_next %}
                <a href="?page={{ empresas.next_num }}" class="nc-btn nc-btn-sm" aria-label="Pr√≥xima p√°gina">Pr√≥xima ‚Üí</a>
                {% endif %}
            </nav>
            {% endif %}
            
        {% else %}
            <div class="nc-empty-state" role="status">
                <span aria-hidden="true">üè¢</span>
                <h3>Nenhuma empresa cadastrada</h3>
                <p>Comece cadastrando a primeira empresa do sistema.</p>
                <a href="{{ url_for('empresas.nova_empresa') }}" class="nc-btn nc-btn-primary">+ Nova empresa</a>
            </div>
        {% endif %}
    {% endif %}
</section>
{% endblock %}
