{% extends "base.html" %}
{% block content %}

<section class="nc-section">

    <h2 class="nc-title">üìÑ Detalhes do Arquivo Importado</h2>

    <!-- ===================== RESUMO EM CARDS ===================== -->
    <div class="detail-cards">
        <div class="detail-card">
            <h4>Nome do Arquivo</h4>
            <p>{{ arquivo.nome_arquivo }}</p>
        </div>

        <div class="detail-card">
            <h4>Tipo</h4>
            <p>{{ arquivo.tipo|capitalize }}</p>
        </div>

        <div class="detail-card">
            <h4>Total de Registros</h4>
            <p>{{ arquivo.total_registros }}</p>
        </div>

        <div class="detail-card">
            <h4>Valor Total</h4>
            <p>R$ {{ "%.2f"|format(arquivo.total_valor) }}</p>
        </div>

        <div class="detail-card">
            <h4>Data de Importa√ß√£o</h4>
            <p>{{ arquivo.created_at }}</p>
        </div>
    </div>

    <hr>

    <!-- ===================== TABS ===================== -->
    <div class="tabs">
        <button class="tab-button active" data-tab="tab-json">JSON</button>
        <button class="tab-button" data-tab="tab-tabela">Tabela</button>
    </div>

    <!-- ===================== CONTE√öDO JSON ===================== -->
    <div id="tab-json" class="tab-content active">
        <h3>üìå Conte√∫do JSON (limitado a 200 registros)</h3>

        <pre class="json-box">
{{ arquivo.registros | tojson(indent=2) }}
        </pre>
    </div>

    <!-- ===================== TABELA ===================== -->
    <div id="tab-tabela" class="tab-content">
        <h3>üìã Visualiza√ß√£o em Tabela</h3>

        {% set registros = arquivo.registros %}
        {% if registros and registros|length > 0 and registros[0] is mapping %}

        <div class="table-wrapper">
            <table class="nc-table">
                <thead>
                    <tr>
                        {% for col in registros[0].keys() %}
                            <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in registros[:200] %}
                    <tr>
                        {% for col in registros[0].keys() %}
                            <td>{{ row[col] }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% else %}
            <p>Este arquivo n√£o cont√©m registros tabulares para exibi√ß√£o.</p>
        {% endif %}
    </div>

    <br>

    <a href="{{ url_for('operacoes.arquivos_importados_page') }}" class="nc-btn-secondary">
        ‚¨ÖÔ∏è Voltar
    </a>

</section>

<style>
    .detail-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    .detail-card {
        background: #fff;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .detail-card h4 {
        margin: 0 0 5px 0;
        font-size: 14px;
        color: #666;
    }
    .detail-card p {
        margin: 0;
        font-size: 16px;
        font-weight: bold;
    }

    .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    .tab-button {
        padding: 10px 18px;
        border: none;
        background: #ececec;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
    }
    .tab-button.active {
        background: #0077ff;
        color: #fff;
    }

    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }

    .json-box {
        background: #1e1e1e;
        color: #b5e853;
        padding: 15px;
        border-radius: 8px;
        max-height: 450px;
        overflow: auto;
        white-space: pre-wrap;
    }

    .table-wrapper {
        max-height: 450px;
        overflow: auto;
        border: 1px solid #ddd;
        border-radius: 8px;
    }
</style>

<script>
    document.querySelectorAll(".tab-button").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
            document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));

            btn.classList.add("active");
            document.getElementById(btn.dataset.tab).classList.add("active");
        });
    });
</script>

{% endblock %}
